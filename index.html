<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeAlone - Exclusive Private Community</title>
    <link rel="preload" href="static/sensual13.jpg" as="image">
    <!-- Tawk.to Chat Widget Script -->
    <script type="text/javascript">
        var Tawk_API=Tawk_API||{}, Tawk_LoadStart=new Date();
        (function(){
            var s1=document.createElement("script"),s0=document.getElementsByTagName("script")[0];
            s1.async=true;
            s1.src='https://embed.tawk.to/68ff212346288f19552eb9d9/1j8i9neiu';
            s1.charset='UTF-8';
            s1.setAttribute('crossorigin','*');
            s0.parentNode.insertBefore(s1,s0);
        })();
    </script>
    <!-- NOWPayments API JS Library -->
    <script src="https://unpkg.com/@nowpaymentsio/nowpayments-api-js/dist/nowpayments-api-js.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Lora:wght@400;600&display=swap');
        body {
            font-family: 'Lora', serif;
            background: linear-gradient(to bottom, #1a1a1a, #2a0033);
            color: #fff;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            line-height: 1.8;
            animation: pulseBackground 10s infinite alternate;
        }
        @keyframes pulseBackground {
            0% { background: linear-gradient(to bottom, #1a1a1a, #2a0033); }
            100% { background: linear-gradient(to bottom, #2a0033, #1a1a1a); }
        }
        h2, h3 {
            font-family: 'Dancing Script', cursive;
            color: #ffcc00;
            text-shadow: 0 0 10px #ff00ff;
        }
        .header {
            background: linear-gradient(to right, #1a1a1a, #330033);
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #ff00ff;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
        }
        .banner {
            width: 100%;
            height: 200px;
            object-fit: cover;
            filter: drop-shadow(0 0 8px #ff00ff);
            animation: zoomBanner 15s infinite ease-in-out;
            margin-bottom: 20px;
        }
        @keyframes zoomBanner {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .header input {
            padding: 10px;
            width: 280px;
            max-width: 100%;
            border: 3px solid #ff00ff;
            border-radius: 12px;
            background: rgba(42, 42, 42, 0.8);
            color: #fff;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        .header input:focus {
            border-color: #ffcc00;
            transform: scale(1.03);
            box-shadow: 0 0 12px rgba(255, 204, 0, 0.6);
            outline: none;
        }
        .header .icons {
            display: flex;
            gap: 20px;
            color: #ffcc00;
            font-weight: 600;
            font-size: 20px;
        }
        .header .icons span {
            cursor: pointer;
            padding: 8px 12px;
            transition: all 0.4s ease;
        }
        .header .icons span:hover {
            color: #ff00ff;
            transform: scale(1.3) rotate(10deg);
            text-shadow: 0 0 8px #ff00ff;
        }
        nav {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
            padding: 0 15px;
        }
        nav a {
            color: #ffcc00;
            text-decoration: none;
            font-weight: 600;
            padding: 12px 25px;
            border: 3px solid #ff00ff;
            border-radius: 15px;
            background: linear-gradient(to right, #2a2a2a, #3a003a);
            transition: all 0.4s ease;
            font-size: 17px;
            text-shadow: 0 0 5px #ff00ff;
        }
        nav a:hover {
            background: #ff00ff;
            color: #000;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.7);
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 25px;
        }
        .section {
            background: rgba(0, 0, 0, 0.75);
            padding: 30px;
            margin: 25px 0;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(255, 0, 255, 0.4);
            animation: fadeIn 0.6s ease-in-out;
            position: relative;
        }
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(25px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        #signup {
            position: relative;
            overflow: hidden;
        }
        #signup video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.3;
            z-index: -1;
        }
        #signup::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(26, 26, 26, 0.7), rgba(42, 0, 51, 0.7));
            z-index: -1;
        }
        .form-group {
            margin: 20px 0;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        input, button {
            padding: 14px;
            width: 320px;
            height: 44px;
            border: 3px solid #ff00ff;
            border-radius: 15px;
            background: rgba(42, 42, 42, 0.8);
            color: #fff;
            font-size: 17px;
            transition: all 0.3s ease;
            box-sizing: border-box;
            position: relative;
            z-index: 1;
        }
        input:focus {
            border-color: #ffcc00;
            transform: scale(1.03);
            box-shadow: 0 0 12px rgba(255, 204, 0, 0.6);
            outline: none;
        }
        button {
            background: linear-gradient(to right, #ff00ff, #cc00cc);
            color: #fff;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.6);
            animation: pulseButton 2s infinite;
        }
        @keyframes pulseButton {
            0% { border-color: #ff00ff; }
            50% { border-color: #ffcc00; }
            100% { border-color: #ff00ff; }
        }
        button:hover {
            background: linear-gradient(to right, #ffcc00, #e6b800);
            transform: scale(1.06);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.8);
        }
        button:active {
            transform: scale(0.94);
        }
        .success-message {
            animation: bounceIn 0.6s ease-in-out;
            color: #ffcc00;
            text-align: center;
            margin: 15px 0;
            font-family: 'Dancing Script', cursive;
            font-size: 20px;
            z-index: 1;
            position: relative;
        }
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.7); }
            50% { transform: scale(1.15); }
            100% { opacity: 1; transform: scale(1); }
        }
        .vip-card {
            background: rgba(34, 34, 34, 0.9);
            padding: 25px;
            margin: 15px;
            border-radius: 15px;
            text-align: center;
            flex: 1 1 280px;
            box-shadow: 0 6px 15px rgba(255, 0, 255, 0.5);
            transition: transform 0.4s ease;
            position: relative;
            z-index: 1;
        }
        .vip-card:hover {
            transform: scale(1.06);
            box-shadow: 0 8px 20px rgba(255, 0, 255, 0.7);
        }
        .vip-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        .popup, .ad-popup {
            position: fixed;
            background: linear-gradient(to bottom, #ff00ff, #cc00cc);
            color: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.6);
            z-index: 1000;
            animation: popupAnim 0.6s ease-in-out;
            text-align: center;
            font-family: 'Lora', serif;
        }
        .popup {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            width: 420px;
        }
        .ad-popup {
            bottom: 20px;
            right: 20px;
            max-width: 90%;
            width: 300px;
            animation: slideIn 0.6s ease-in-out;
        }
        @keyframes popupAnim {
            0% { opacity: 0; transform: translate(-50%, -60%) scale(0.7); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        @keyframes slideIn {
            0% { opacity: 0; transform: translateY(100px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .announcement {
            background: linear-gradient(to right, #ffcc00, #e6b800);
            color: #000;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            font-weight: 600;
            font-family: 'Dancing Script', cursive;
            animation: announceAnim 1.5s infinite alternate;
        }
        @keyframes announceAnim {
            0% { background: linear-gradient(to right, #ffcc00, #e6b800); }
            100% { background: linear-gradient(to right, #ff00ff, #cc00cc); }
        }
        .chat-box {
            height: 280px;
            overflow-y: auto;
            background: rgba(42, 42, 42, 0.8);
            padding: 20px;
            border: 3px solid #ff00ff;
            border-radius: 12px;
            margin: 15px 0;
            position: relative;
            z-index: 1;
        }
        .chat-message {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 0, 255, 0.2);
            border-radius: 8px;
            font-size: 16px;
        }
        .chat-message span {
            color: #ffcc00;
            font-weight: 600;
        }
        .gallery {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 15px;
        }
        .item {
            border: 3px solid #ff00ff;
            padding: 15px;
            text-align: center;
            background: rgba(34, 34, 34, 0.9);
            border-radius: 12px;
            transition: all 0.4s ease;
            position: relative;
            z-index: 1;
        }
        .item:hover {
            transform: scale(1.06);
            box-shadow: 0 6px 20px rgba(255, 0, 255, 0.6);
        }
        .item img {
            max-width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
            filter: brightness(0.9);
            transition: filter 0.3s ease;
        }
        .item img:hover {
            filter: brightness(1.1);
        }
        .item p {
            margin: 10px 0 0;
            font-size: 18px;
            color: #ffcc00;
            font-family: 'Dancing Script', cursive;
        }
        .featured-gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        .highlight-item {
            background: rgba(34, 34, 34, 0.9);
            padding: 20px;
            border-radius: 12px;
            border: 3px solid #ff00ff;
            text-align: center;
            flex: 1 1 320px;
            max-width: 320px;
            position: relative;
            z-index: 1;
        }
        .highlight-item img {
            max-width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 10px;
        }
        #age-gate {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 25px;
        }
        #banner {
            font-size: 2.5em;
            color: #ffcc00;
            text-shadow: 3px 3px 6px #ff00ff;
            margin: 30px 0;
            text-align: center;
            font-family: 'Dancing Script', cursive;
        }
        .hidden {
            display: none;
        }
        #cart-items {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }
        .cart-item {
            background: rgba(34, 34, 34, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #ff00ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }
        .cart-item:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 10px rgba(255, 0, 255, 0.5);
        }
        .cart-item p {
            margin: 0;
            color: #ffcc00;
            font-family: 'Lora', serif;
        }
        .cart-item button {
            background: linear-gradient(to right, #ff3333, #cc0000);
            border: 2px solid #ff3333;
            padding: 8px 12px;
            height: auto;
        }
        .cart-item button:hover {
            background: linear-gradient(to right, #ff6666, #ff3333);
            border-color: #ff6666;
        }
        #cart-total {
            font-weight: 600;
            color: #ffcc00;
            font-size: 20px;
        }
        #checkout-button:disabled {
            background: rgba(42, 42, 42, 0.8);
            border-color: #666;
            cursor: not-allowed;
            box-shadow: none;
        }
        #payment-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 10px 0;
        }
        #gift-card-upload {
            display: none;
            margin-top: 10px;
        }
        #gift-card-upload input[type="file"] {
            width: 100%;
        }
        .nowpayments-iframe {
            width: 100%;
            height: 600px;
            border: none;
            border-radius: 15px;
        }
        /* Footer Styles */
        footer {
            background: linear-gradient(to right, #1a1a1a, #330033);
            padding: 40px 20px;
            border-top: 4px solid #ff00ff;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.6);
            color: #fff;
            font-family: 'Lora', serif;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }
        .footer-logo {
            font-family: 'Dancing Script', cursive;
            font-size: 2em;
            color: #ffcc00;
            text-shadow: 0 0 10px #ff00ff;
            margin: 0;
        }
        .footer-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        .footer-nav a {
            color: #ffcc00;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            padding: 8px 15px;
            border: 2px solid #ff00ff;
            border-radius: 10px;
            background: rgba(42, 42, 42, 0.8);
            transition: all 0.3s ease;
        }
        .footer-nav a:hover {
            background: #ff00ff;
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.7);
        }
        .footer-social {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .footer-social a {
            color: #ffcc00;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        .footer-social a:hover {
            color: #ff00ff;
            transform: scale(1.2) rotate(5deg);
            text-shadow: 0 0 8px #ff00ff;
        }
        .footer-copyright {
            margin-top: 20px;
            font-size: 14px;
            color: #ccc;
        }
        @media (max-width: 1024px) {
            .banner {
                height: 150px;
            }
            .gallery {
                grid-template-columns: repeat(2, 1fr);
            }
            .header {
                flex-direction: column;
                gap: 15px;
            }
            .header input {
                width: 100%;
                max-width: 320px;
            }
            nav {
                flex-direction: column;
                align-items: center;
            }
            nav a {
                width: 100%;
                max-width: 280px;
                text-align: center;
            }
            input, button {
                width: 100%;
                max-width: 280px;
                height: 42px;
            }
            .highlight-item {
                flex: 1 1 280px;
                max-width: 280px;
            }
            .nowpayments-iframe {
                height: 500px;
            }
            .footer-container {
                flex-direction: column;
                gap: 25px;
            }
            .footer-nav {
                flex-direction: column;
                align-items: center;
            }
            .footer-nav a {
                width: 100%;
                max-width: 240px;
            }
        }
        @media (max-width: 768px) {
            .banner {
                height: 120px;
            }
            .gallery {
                grid-template-columns: 1fr;
            }
            .item img {
                height: 140px;
            }
            .header input {
                max-width: 240px;
            }
            .header .icons {
                gap: 12px;
                font-size: 18px;
            }
            .popup, .ad-popup {
                width: 90%;
                max-width: 320px;
                padding: 15px;
            }
            #banner {
                font-size: 2em;
            }
            .section {
                padding: 20px;
            }
            input, button {
                max-width: 240px;
                height: 38px;
            }
            .highlight-item {
                flex: 1 1 240px;
                max-width: 240px;
            }
            .highlight-item img {
                height: 140px;
            }
            .nowpayments-iframe {
                height: 400px;
            }
            .footer-logo {
                font-size: 1.8em;
            }
            .footer-social a {
                font-size: 20px;
            }
        }
        @media (max-width: 480px) {
            .banner {
                height: 100px;
            }
            .header input {
                max-width: 180px;
            }
            nav a {
                font-size: 15px;
                padding: 10px 18px;
            }
            .vip-card {
                flex: 1 1 100%;
            }
            .nowpayments-iframe {
                height: 350px;
            }
            .footer-logo {
                font-size: 1.5em;
            }
            .footer-nav a {
                font-size: 14px;
                padding: 8px 12px;
            }
            .footer-copyright {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="age-gate">
        <h2 style="color: #ff00ff; font-size: 2.5em;" aria-label="Age verification prompt">Are you ready to explore MeAlone?</h2>
        <button onclick="enterSite()" tabindex="0" onkeydown="if(event.key === 'Enter') enterSite()" aria-label="Enter site if 18 or older">Yes, Seduce Me</button>
        <button onclick="leaveSite()" tabindex="0" onkeydown="if(event.key === 'Enter') leaveSite()" aria-label="Leave site if under 18">No, I'm Shy</button>
    </div>

    <div class="header">
        <img src="static/sensual10.jpg" class="banner" alt="MeAlone seductive banner image" aria-label="MeAlone promotional banner" onerror="this.src='static/images/fallback.jpg'">
        <input type="text" placeholder="Search for Desire..." aria-label="Search MeAlone">
        <div class="icons">
            <span aria-label="Cams section">Cams</span>
            <span aria-label="Add content">+</span>
            <span aria-label="More options">‚ãÆ</span>
            <span aria-label="Notifications">‚ìø</span>
            <span aria-label="Downloads">‚Üì</span>
            <span onclick="showSection('cart')" aria-label="View cart">üõí <span id="cart-count">0</span></span>
        </div>
    </div>

    <div id="banner" aria-label="Promotional banner">Indulge in Exclusive Pleasures with MeAlone</div>

    <nav>
        <a href="#home" onclick="showSection('home')" aria-label="Go to Home">Home</a>
        <a href="#signup" onclick="showSection('signup')" aria-label="Go to Signup">Signup</a>
        <a href="#login" onclick="showSection('login')" aria-label="Go to Login">Login</a>
        <a href="#gallery" onclick="showSection('gallery')" class="hidden" id="gallery-nav" aria-label="Go to Gallery">Gallery</a>
        <a href="#dashboard" onclick="showSection('dashboard')" class="hidden" id="dashboard-nav" aria-label="Go to Dashboard">Dashboard</a>
        <a href="#vip" onclick="showSection('vip')" class="hidden" id="vip-nav" aria-label="Go to VIP Content">VIP Secrets</a>
        <a href="#live" onclick="showSection('live')" class="hidden" id="live-nav" aria-label="Go to Live Stream">Live Passion</a>
        <a href="#chat" onclick="showSection('chat')" class="hidden" id="chat-nav" aria-label="Go to Premium Chat">Intimate Chat</a>
        <a href="#cart" onclick="showSection('cart')" class="hidden" id="cart-nav" aria-label="Go to Cart">Cart</a>
        <a href="#admin" onclick="showSection('admin')" class="hidden" id="admin-nav" aria-label="Go to Admin Panel">Admin</a>
    </nav>

    <div class="container">
        <div id="home" class="section">
            <h2>Welcome to MeAlone</h2>
            <p>Dive into a world of exclusive desires and intimate connections. Join our private community to unlock tantalizing content!</p>
            <div id="announcements"></div>
            <div class="section">
                <h3>Featured Temptations</h3>
                <div id="featured-content" class="featured-gallery"></div>
                <div class="form-group">
                    <button onclick="showSection('gallery')" aria-label="View more gallery content">Explore More</button>
                </div>
            </div>
            <div class="section">
                <h3>Community Whispers</h3>
                <div id="community-highlights"></div>
            </div>
            <div class="section">
                <h3>Unveil Your Desires</h3>
                <p>Unlock a treasure trove of exclusive content, live streams, and private chats with a MeAlone subscription.</p>
                <ul style="color: #ffcc00;">
                    <li>Sensual gallery images await</li>
                    <li>Exclusive video clips to ignite your passion</li>
                    <li>Join our sultry community chat</li>
                </ul>
                <div class="form-group">
                    <button onclick="showSection('signup')" aria-label="Join now for subscription">Join the Temptation</button>
                </div>
            </div>
        </div>

        <div id="signup" class="section hidden">
            <video autoplay muted loop playsinline poster="static/sensual10.jpg" aria-label="Seductive background video for signup section">
                <source src="static/maria1.mp4" type="video/webm">
                <source src="static/maria3.mp4" type="video/mp4">
                <img src="static/sensual5.jpg" alt="Fallback seductive background image for signup section" onerror="this.src='static/sensual12'">
            </video>
            <h2>Begin Your Journey</h2>
            <div class="form-group">
                <input type="email" id="signup-email" placeholder="Your Email..." aria-label="Enter email for signup">
            </div>
            <div class="form-group">
                <input type="password" id="signup-password" placeholder="Your Secret..." aria-label="Enter password for signup">
            </div>
            <div class="form-group">
                <button onclick="signup()" aria-label="Submit signup">Join Now</button>
            </div>
            <div id="signup-message" class="success-message hidden"></div>
        </div>

        <div id="login" class="section hidden">
            <h2>Reignite the Spark</h2>
            <div class="form-group">
                <input type="email" id="login-email" placeholder="Your Email..." aria-label="Enter email for login">
            </div>
            <div class="form-group">
                <input type="password" id="login-password" placeholder="Your Secret..." aria-label="Enter password for login">
            </div>
            <div class="form-group">
                <button onclick="login()" aria-label="Submit login">Enter</button>
            </div>
            <div id="login-message" class="success-message hidden"></div>
        </div>

        <div id="gallery" class="section hidden">
            <h2>Sensual Gallery</h2>
            <div id="content-gallery" class="gallery"></div>
        </div>

        <div id="dashboard" class="section hidden">
            <h2>Your Private Haven</h2>
            <p>Membership ID: <span id="member-id">Guest</span></p>
            <div class="section">
                <h3>Update Profile</h3>
                <div class="form-group">
                    <input type="email" id="profile-email" placeholder="New Email..." aria-label="Enter new email">
                </div>
                <div class="form-group">
                    <button onclick="updateProfile()" aria-label="Update profile">Update</button>
                </div>
            </div>
            <div class="section">
                <h3>Share Your Allure (Up to 3)</h3>
                <div class="form-group">
                    <input type="text" id="upload-name" placeholder="Photo Name..." aria-label="Enter photo name">
                </div>
                <div class="form-group">
                    <input type="file" id="photo-upload" accept="image/*" multiple aria-label="Upload photos">
                </div>
                <div class="form-group">
                    <button onclick="uploadPhotos()" aria-label="Upload selected photos">Upload</button>
                </div>
                <div id="user-gallery" class="gallery"></div>
            </div>
            <div id="payment-responses"></div>
            <div id="dashboard-message" class="success-message hidden"></div>
        </div>

        <div id="vip" class="section hidden">
            <h2>Exclusive Secrets</h2>
            <div class="vip-list">
                <div class="vip-card">
                    <h3>üî• Dogknotty Clips üìÅ</h3>
                    <p>Unleash your wild side - $19.99</p>
                    <div class="form-group">
                        <button onclick="payForVip('Dogknotty clips')" aria-label="Pay to unlock Dogknotty clips">Unlock Now</button>
                        <button onclick="addToCart('Dogknotty clips', 19.99)" aria-label="Add Dogknotty clips to cart">Add to Cart</button>
                    </div>
                    <div id="vip-dogknotty" class="hidden">Unlocked: Dive into the clips</div>
                </div>
                <div class="vip-card">
                    <h3>üî• Nude Images Dropbox üìÅ</h3>
                    <p>Bare it all with high-quality images - $14.99</p>
                    <div class="form-group">
                        <button onclick="payForVip('Nude images')" aria-label="Pay to unlock Nude images">Unlock Now</button>
                        <button onclick="addToCart('Nude images', 14.99)" aria-label="Add Nude images to cart">Add to Cart</button>
                    </div>
                    <div id="vip-nude" class="hidden">Unlocked: Access images</div>
                </div>
                <div class="vip-card">
                    <h3>üî• Feet Worship Clips üìÅ</h3>
                    <p>Indulge in fetish fantasies - $9.99</p>
                    <div class="form-group">
                        <button onclick="payForVip('Feet worship clips')" aria-label="Pay to unlock Feet worship clips">Unlock Now</button>
                        <button onclick="addToCart('Feet worship clips', 9.99)" aria-label="Add Feet worship clips to cart">Add to Cart</button>
                    </div>
                    <div id="vip-feet" class="hidden">Unlocked: Access clips</div>
                </div>
                <div class="vip-card">
                    <h3>üî• VIP üíé Pass</h3>
                    <p>Unlimited seduction awaits - $49.99</p>
                    <div class="form-group">
                        <button onclick="payForVip('VIP pass')" aria-label="Pay to unlock VIP pass">Unlock Now</button>
                        <button onclick="addToCart('VIP pass', 49.99)" aria-label="Add VIP pass to cart">Add to Cart</button>
                    </div>
                    <div id="vip-pass" class="hidden">Unlocked: Full access</div>
                </div>
            </div>
        </div>

        <div id="live" class="section hidden">
            <h2>Live Passion Streams</h2>
            <video id="live-video" controls style="width:100%; max-width:800px; border-radius: 12px;" aria-label="Live stream video player"></video>
            <div class="form-group">
                <button onclick="payForLive()" aria-label="Pay to watch live stream">Unlock Live Passion</button>
                <button onclick="addToCart('Live Stream', 29.99)" aria-label="Add Live Stream to cart">Add to Cart</button>
            </div>
            <div id="live-content" class="hidden">Live stream unlocked</div>
        </div>

        <div id="cart" class="section hidden">
            <h2>Your Cart</h2>
            <div id="cart-items" aria-live="polite"></div>
            <div class="form-group">
                <p>Total: <span id="cart-total">$0.00</span></p>
            </div>
            <div class="form-group">
                <button onclick="checkout()" aria-label="Proceed to checkout" id="checkout-button" disabled>Checkout</button>
            </div>
            <div id="cart-message" class="success-message hidden"></div>
        </div>

        <div id="chat" class="section hidden">
            <h2>Intimate Chat Lounge</h2>
            <div class="chat-box" id="chat-messages" aria-live="polite"></div>
            <div class="form-group">
                <input type="text" id="chat-input" placeholder="Whisper your desires..." aria-label="Type chat message">
            </div>
            <div class="form-group">
                <button onclick="sendChat()" aria-label="Send chat message">Send</button>
            </div>
            <div id="chat-message" class="success-message hidden"></div>
        </div>

        <div id="admin" class="section hidden">
            <h2>Admin Control Room</h2>
            <h3>Admin Access</h3>
            <div class="form-group">
                <input type="email" id="admin-email" placeholder="Admin Email..." aria-label="Enter admin email">
            </div>
            <div class="form-group">
                <input type="password" id="admin-password" placeholder="Password..." aria-label="Enter admin password">
            </div>
            <div class="form-group">
                <button onclick="adminLogin()" aria-label="Submit admin login">Login</button>
            </div>
            <div id="admin-controls" class="hidden">
                <h3>Curate Gallery Content</h3>
                <div class="form-group">
                    <input type="text" id="admin-upload-name" placeholder="Content Name..." aria-label="Enter content name">
                </div>
                <div class="form-group">
                    <input type="file" id="admin-upload" accept="image/*" multiple aria-label="Upload content to gallery">
                </div>
                <div class="form-group">
                    <button onclick="adminUpload()" aria-label="Upload selected content">Upload</button>
                </div>
                <div id="admin-gallery" class="gallery"></div>
                <h3>Payment Requests</h3>
                <div id="admin-payments"></div>
                <h3>Gift Card Verifications</h3>
                <div id="admin-gift-cards"></div>
                <h3>Send Response</h3>
                <div class="form-group">
                    <input type="text" id="response-user" placeholder="User Email" aria-label="Enter user email for response">
                </div>
                <div class="form-group">
                    <input type="text" id="response-message" placeholder="Message" aria-label="Enter response message">
                </div>
                <div class="form-group">
                    <button onclick="sendResponse()" aria-label="Send response to user">Send</button>
                </div>
            </div>
            <div id="admin-message" class="success-message hidden"></div>
        </div>
    </div>

    <div id="popup-container"></div>

    <footer>
        <div class="footer-container">
            <h2 class="footer-logo" aria-label="MeAlone logo">MeAlone</h2>
            <nav class="footer-nav">
                <a href="#home" onclick="showSection('home')" aria-label="Go to Home page">Home</a>
                <a href="#privacy" onclick="showSection('privacy')" aria-label="View Privacy Policy">Privacy Policy</a>
                <a href="#terms" onclick="showSection('terms')" aria-label="View Terms of Service">Terms of Service</a>
                <a href="#contact" onclick="showSection('contact')" aria-label="Contact Us">Contact Us</a>
            </nav>
            <div class="footer-social">
                <a href="https://x.com/mariedeejnr?t=ULk6OyhDdXIOrWf85lFNHw&s=09" target="_blank" aria-label="Follow MeAlone on Twitter">ùïè</a>
                <a href="https://wa.link/wdxvea" target="_blank" aria-label="Follow MeAlone on whatsApp">üì∏</a>
                <a href="https://discord.com" target="_blank" aria-label="Join MeAlone on Discord">üéÆ</a>
            </div>
            <p class="footer-copyright">¬© <span id="copyright-year"></span> MeAlone. All rights reserved. steady b</p>
        </div>
    </footer>

<!-- SPLIT POINT: JavaScript code follows in Part 2 -->
<script>
    // Data and state
    let currentUser = JSON.parse(localStorage.getItem('currentUser')) || { email: 'guest', id: 'Guest', token: null, isAdmin: false };
    let uploads = [];
    let adminUploads = [];
    let chatMessages = [];
    let paymentResponses = [];
    let vipUnlocks = [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let ws = null;
    const telegramLink = 'https://t.me/MariedeeOFP';
    const affiliateLinks = [
        { text: 'Discover More Sensual Content!', url: 'https://affiliate-link1.com' },
        { text: 'Unlock Exclusive Deals!', url: 'https://affiliate-link2.com' },
        { text: 'Join the Hottest Community!', url: 'https://affiliate-link3.com' }
    ];
    const nowpaymentsApiKey = '8PSX1AV-9KJM7QQ-NQKVGPX-HTDQ978'; // Replace with your actual NOWPayments API key
    const nowpaymentsApi = new NOWPaymentsApiJS({ apiKey: nowpaymentsApiKey });

    const prices = {
        'Dogknotty clips': 100.99,
        'Nude images': 50.99,
        'Feet worship clips': 50.99,
        'VIP pass': 200.00,
        'Live Stream': 200.00
    };

    const testimonies = [
        'This site sets my heart ablaze! - SeductiveFan1',
        'Pure ecstasy in every click! - NaughtyFan2',
        'The hottest community ever! - VIPTease3',
        'I‚Äôm hooked on MeAlone! - TemptedFan4',
        'Unleash your desires here! - knotty lover'
    ];

    const defaultGalleryItems = [
        { src: '/static/sensual.jpg', name: 'EmeraldOstara' },
        { src: '/static/sensual2.jpg', name: 'BadGirlRubes' },
        { src: '/static/sensual3.jpg', name: 'Mae_Rainz' },
        { src: '/static/sensual4.jpg', name: 'Hottyhousewife18' },
        { src: '/static/sensual5.jpg', name: 'Vanessaxoxo2022' },
        { src: '/static/sensual6.jpg', name: 'battletits_a' },
        { src: '/static/sensual7.jpg', name: 'DaishaSweet' },
        { src: '/static/sensual8.jpg', name: 'MindyChang' },
        { src: '/static/sensual9.jpg', name: 'Your_Girl_Sam' },
        { src: '/static/sensual10.jpg', name: 'Kimikoda' },
        { src: '/static/sensual11.jpg', name: 'VelvetVixen' },
        { src: '/static/sensual12.jpg', name: 'LunaStar' },
        { src: '/static/sensual13.jpg', name: 'SashaSiren' },
        { src: '/static/sensual14.jpg', name: 'RavenRose' },
        { src: '/static/sensual15.jpg', name: 'IvyLush' },
        { src: '/static/sensual16.jpg', name: 'FoxyFlame' },
        { src: '/static/sensual17.jpg', name: 'StarlaSpark' },
        { src: '/static/sensual18.jpg', name: 'ZaraZest' },
        { src: '/static/sensual19.jpg', name: 'MilaMuse' },
        { src: '/static/sensual20.jpg', name: 'TaraTease' },
        { src: '/static/sensual21.jpg', name: 'NixieNymph' },
        { src: '/static/sensual22.jpg', name: 'SeleneSwoon' },
        { src: '/static/sensual23.jpg', name: 'VeraVamp' },
        { src: '/static/sensual24.jpg', name: 'LilaLure' },
        { src: '/static/sensual25.jpg', name: 'CoraCharm' },
        { src: '/static/sensual26.jpg', name: 'EsmeEnchant' },
        { src: '/static/sensual27.jpg', name: 'FayeFever' },
        { src: '/static/sensual28.jpg', name: 'GiaGlow' },
        { src: '/static/sensual29.jpg', name: 'HazelHush' },
        { src: '/static/sensual30.jpg', name: 'JadeJewel' }
    ];

    const videoOptions = [
        { webm: '/static/videos/signup-bg1.webm', mp4: '/static/maria1.mp4' },
        { webm: '/static/videos/signup-bg2.webm', mp4: '/static/maria2.mp4' },
        { webm: '/static/videos/signup-bg3.webm', mp4: '/static/maria3.mp4' }
    ];

    // Randomly select a video for signup section
    function selectRandomVideo() {
        const video = videoOptions[Math.floor(Math.random() * videoOptions.length)];
        const videoElement = document.querySelector('#signup video');
        videoElement.innerHTML = `
            <source src="${video.webm}" type="video/webm">
            <source src="${video.mp4}" type="video/mp4">
            <img src="/static/images/signup-poster.jpg" alt="Fallback seductive background image for signup section" onerror="this.src='/static/sensual26'">
        `;
    }

    // API helper with JWT
    async function apiFetch(url, options = {}) {
        options.headers = {
            ...options.headers,
            'Authorization': `Bearer ${currentUser.token}`
        };
        if (!(options.body instanceof FormData)) {
            options.headers['Content-Type'] = 'application/json';
        }
        const response = await fetch(`https://mealone-backend.onrender.com${url}`, options);
        const data = await response.json();
        if (!response.ok) {
            throw data;
        }
        return data;
    }

    // WebSocket handling
    function connectWebSocket() {
        if (!currentUser.token) {
            showSuccessMessage('chat-message', 'Please login to join the chat');
            return;
        }

        ws = new WebSocket(`wss://mealone-backend.onrender.com?token=${currentUser.token}`);

        ws.onopen = () => {
            console.log('WebSocket connected');
            showSuccessMessage('chat-message', 'Connected to chat lounge');
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === 'init') {
                chatMessages = data.messages;
                renderChatMessages();
            } else if (data.type === 'message') {
                chatMessages.push(data);
                renderChatMessages();
                const chatBox = document.getElementById('chat-messages');
                chatBox.scrollTop = chatBox.scrollHeight;
            } else if (data.type === 'error') {
                showSuccessMessage('chat-message', data.message);
            }
        };

        ws.onclose = () => {
            showSuccessMessage('chat-message', 'Chat disconnected. Reconnecting...');
            setTimeout(connectWebSocket, 5000);
        };

        ws.onerror = () => {
            showSuccessMessage('chat-message', 'Chat error. Reconnecting...');
            ws.close();
        };
    }

    function renderChatMessages() {
        const chatBox = document.getElementById('chat-messages');
        chatBox.innerHTML = '';
        chatMessages.forEach(msg => {
            const div = document.createElement('div');
            div.classList.add('chat-message');
            div.innerHTML = `<span>${msg.user}</span>: ${msg.text} <small>(${new Date(msg.createdAt).toLocaleTimeString()})</small>`;
            chatBox.appendChild(div);
        });
    }

    function sendChat() {
        const input = document.getElementById('chat-input');
        const text = input.value.trim();

        if (!text) {
            showSuccessMessage('chat-message', 'Please enter a message');
            return;
        }
        if (text.length > 500) {
            showSuccessMessage('chat-message', 'Message too long');
            return;
        }

        if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify({ type: 'message', text }));
            input.value = '';
        } else {
            showSuccessMessage('chat-message', 'Chat not connected. Please try again.');
        }
    }

    // Navigation and UI
    function enterSite() {
        document.getElementById('age-gate').style.display = 'none';
        selectRandomVideo();
        loadFeaturedContent();
        loadCommunityHighlights();
        startAdPopups();
        if (currentUser.token) {
            loadProtectedContent();
        }
    }

    function leaveSite() {
        window.location.href = 'https://www.google.com';
    }

    function showSection(section) {
        const sections = ['home', 'signup', 'login', 'gallery', 'dashboard', 'vip', 'live', 'chat', 'admin', 'cart'];
        sections.forEach(s => document.getElementById(s).classList.add('hidden'));
        document.getElementById(section).classList.remove('hidden');
        if (section === 'gallery') loadContentGallery();
        if (section === 'dashboard') loadPaymentResponses();
        if (section === 'chat') {
            if (currentUser.token && !ws) connectWebSocket();
            renderChatMessages();
        }
        if (section === 'vip') loadVipUnlocks();
        if (section === 'admin' && currentUser.isAdmin) {
            document.getElementById('admin-controls').classList.remove('hidden');
            loadAdminPayments();
            loadAdminGiftCards();
        }
        if (section === 'cart') updateCartUI();
    }

    function showSuccessMessage(elementId, message) {
        const messageEl = document.getElementById(elementId);
        messageEl.innerText = message;
        messageEl.classList.remove('hidden');
        setTimeout(() => messageEl.classList.add('hidden'), 3000);
    }

    function loadProtectedContent() {
        ['gallery-nav', 'dashboard-nav', 'vip-nav', 'live-nav', 'chat-nav', 'cart-nav'].forEach(id => {
            document.getElementById(id).classList.remove('hidden');
        });
        if (currentUser.isAdmin) {
            document.getElementById('admin-nav').classList.remove('hidden');
        }
        document.getElementById('member-id').innerText = currentUser.id;
        updateCartUI();
    }

    // Authentication
    async function signup() {
        const email = document.getElementById('signup-email').value;
        const password = document.getElementById('signup-password').value;

        if (!email.match(/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/)) {
            showSuccessMessage('signup-message', 'Please enter a valid email');
            return;
        }
        if (password.length < 6) {
            showSuccessMessage('signup-message', 'Password must be at least 6 characters');
            return;
        }

        try {
            const data = await apiFetch('/api/auth/signup', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            });
            currentUser = { email: data.email, id: data.id, token: data.token, isAdmin: false };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            loadProtectedContent();
            showSuccessMessage('signup-message', 'Welcome to the seduction! Loading gallery...');
            setTimeout(() => showSection('gallery'), 1000);
        } catch (error) {
            showSuccessMessage('signup-message', error.errors?.join(', ') || error.error || 'Signup failed');
        }
    }

    async function login() {
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        if (!email.match(/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/)) {
            showSuccessMessage('login-message', 'Please enter a valid email');
            return;
        }
        if (!password) {
            showSuccessMessage('login-message', 'Please enter a password');
            return;
        }

        try {
            const data = await apiFetch('/api/auth/signin', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            });
            currentUser = { email: data.email, id: data.id, token: data.token, isAdmin: data.isAdmin };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            loadProtectedContent();
            showSuccessMessage('login-message', 'Welcome back, darling! Loading gallery...');
            setTimeout(() => showSection('gallery'), 1000);
        } catch (error) {
            showSuccessMessage('login-message', error.errors?.join(', ') || error.error || 'Login failed');
        }
    }

    async function adminLogin() {
        const email = document.getElementById('admin-email').value;
        const password = document.getElementById('admin-password').value;

        if (!email.match(/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/)) {
            showSuccessMessage('admin-message', 'Please enter a valid email');
            return;
        }
        if (!password) {
            showSuccessMessage('admin-message', 'Please enter a password');
            return;
        }

        try {
            const data = await apiFetch('/api/auth/admin/login', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            });
            currentUser = { email: data.email, id: data.id, token: data.token, isAdmin: data.isAdmin };
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            loadProtectedContent();
            document.getElementById('admin-controls').classList.remove('hidden');
            loadAdminPayments();
            loadAdminGiftCards();
            showSuccessMessage('admin-message', 'Access granted, master!');
        } catch (error) {
            showSuccessMessage('admin-message', error.errors?.join(', ') || error.error || 'Admin login failed');
        }
    }

    // Profile
    async function updateProfile() {
        const email = document.getElementById('profile-email').value;

        if (!email.match(/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/)) {
            showSuccessMessage('dashboard-message', 'Please enter a valid email');
            return;
        }

        try {
            const data = await apiFetch('/api/profile', {
                method: 'PUT',
                body: JSON.stringify({ email })
            });
            currentUser.email = data.email;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showSuccessMessage('dashboard-message', 'Profile updated');
        } catch (error) {
            showSuccessMessage('dashboard-message', error.errors?.join(', ') || error.error || 'Profile update failed');
        }
    }

    // Gallery and Content
    function loadFeaturedContent() {
        const gallery = document.getElementById('featured-content');
        gallery.innerHTML = '';
        const shuffledItems = [...defaultGalleryItems].sort(() => Math.random() - 0.5).slice(0, 3);
        shuffledItems.forEach(item => {
            const div = document.createElement('div');
            div.classList.add('highlight-item');
            div.innerHTML = `
                <img src="${item.src}" alt="${item.name}" loading="lazy" onerror="this.src='/static/sensual21'">
                <p>${item.name}</p>
            `;
            gallery.appendChild(div);
        });
    }

    function loadCommunityHighlights() {
        const highlights = document.getElementById('community-highlights');
        highlights.innerHTML = '';
        const shuffledTestimonies = [...testimonies].sort(() => Math.random() - 0.5).slice(0, 3);
        shuffledTestimonies.forEach(testimony => {
            const p = document.createElement('p');
            p.innerText = testimony;
            p.style.color = '#ffcc00';
            highlights.appendChild(p);
        });
    }

    async function loadContentGallery() {
        const gallery = document.getElementById('content-gallery');
        gallery.innerHTML = '';
        try {
            const adminUploadsData = await apiFetch('/api/admin/uploads');
            adminUploads = adminUploadsData;
            const allItems = [...defaultGalleryItems, ...adminUploads];
            allItems.forEach((item, index) => {
                const isPremium = index >= Math.floor(allItems.length / 2);
                const isUnlocked = vipUnlocks.some(v => v.item === `gallery-item-${index}`);
                const div = document.createElement('div');
                div.classList.add('item');
                div.innerHTML = `
                    <img src="${item.src}" alt="${item.name}" loading="lazy" onerror="this.src='/static/images/fallback.jpg'">
                    <p>${item.name}</p>
                    ${isPremium && !isUnlocked ? `
                        <p>$100.99</p>
                        <button onclick="payForGallery(${index})" aria-label="Unlock premium content for ${item.name}">Unlock Temptation</button>
                        <button onclick="addToCart('Gallery Item ${index}', 4.99, ${index})" aria-label="Add ${item.name} to cart">Add to Cart</button>
                    ` : ''}
                    ${isUnlocked ? '<p style="color: #ffcc00;">Unlocked!</p>' : ''}
                `;
                gallery.appendChild(div);
            });
        } catch (error) {
            showSuccessMessage('dashboard-message', 'Failed to load gallery');
        }
    }

    // Uploads
    async function uploadPhotos() {
        const files = document.getElementById('photo-upload').files;
        const name = document.getElementById('upload-name').value;

        if (files.length + uploads.length > 3) {
            showSuccessMessage('dashboard-message', 'Max 3 uploads allowed');
            return;
        }
        for (let file of files) {
            if (!file.type.startsWith('image/')) {
                showSuccessMessage('dashboard-message', 'Only images are allowed');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                showSuccessMessage('dashboard-message', 'File too large (max 5MB)');
                return;
            }
        }

        const formData = new FormData();
        formData.append('name', name);
        for (let file of files) {
            formData.append('photos', file);
        }

        try {
            const data = await apiFetch('/api/upload', {
                method: 'POST',
                body: formData,
                headers: {}
            });
            uploads = [...uploads, ...data.uploads];
            loadUploads();
            showSuccessMessage('dashboard-message', 'Your allure shines!');
        } catch (error) {
            showSuccessMessage('dashboard-message', error.errors?.join(', ') || error.error || 'Upload failed');
        }
    }

    async function loadUploads() {
        const gallery = document.getElementById('user-gallery');
        gallery.innerHTML = '';
        try {
            uploads = await apiFetch('/api/upload');
            uploads.forEach((item, index) => {
                const div = document.createElement('div');
                div.classList.add('item');
                div.innerHTML = `
                    <img src="https://mealone-backend.onrender.com${item.src}" alt="User Upload ${index + 1}" loading="lazy" onerror="this.src='/static/images/fallback.jpg'">
                    <p>${item.name}</p>
                `;
                gallery.appendChild(div);
            });
        } catch (error) {
            showSuccessMessage('dashboard-message', 'Failed to load uploads');
        }
    }

    async function adminUpload() {
        const files = document.getElementById('admin-upload').files;
        const name = document.getElementById('admin-upload-name').value;

        for (let file of files) {
            if (!file.type.startsWith('image/')) {
                showSuccessMessage('admin-message', 'Only images are allowed');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                showSuccessMessage('admin-message', 'File too large (max 5MB)');
                return;
            }
        }

        const formData = new FormData();
        formData.append('name', name);
        for (let file of files) {
            formData.append('photos', file);
        }

        try {
            const data = await apiFetch('/api/admin/upload', {
                method: 'POST',
                body: formData,
                headers: {}
            });
            adminUploads = [...adminUploads, ...data.uploads];
            loadAdminGallery();
            showSuccessMessage('admin-message', 'Content curated!');
        } catch (error) {
            showSuccessMessage('admin-message', error.errors?.join(', ') || error.error || 'Upload failed');
        }
    }

    async function loadAdminGallery() {
        const gallery = document.getElementById('admin-gallery');
        gallery.innerHTML = '';
        try {
            adminUploads = await apiFetch('/api/admin/uploads');
            adminUploads.forEach((item, index) => {
                const div = document.createElement('div');
                div.classList.add('item');
                div.innerHTML = `
                    <img src="https://mealone-backend.onrender.com${item.src}" alt="Admin Upload ${index + 1}" loading="lazy" onerror="this.src='/static/images/fallback.jpg'">
                    <p>${item.name}</p>
                `;
                gallery.appendChild(div);
            });
        } catch (error) {
            showSuccessMessage('admin-message', 'Failed to load admin gallery');
        }
    }

    // Cart and Payments
    function initCart() {
        updateCartUI();
        if (currentUser.token) {
            document.getElementById('cart-nav').classList.remove('hidden');
        }
    }

    function addToCart(item, price, galleryIndex = null) {
        if (!currentUser.token) {
            showSuccessMessage('cart-message', 'Please login to add items to cart');
            showSection('login');
            return;
        }

        if (galleryIndex === null && cart.some(cartItem => cartItem.item === item)) {
            showSuccessMessage('cart-message', `${item} is already in your cart`);
            return;
        }

        const cartItem = {
            item: galleryIndex !== null ? `Gallery Item ${galleryIndex}` : item,
            price,
            galleryIndex
        };

        cart.push(cartItem);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();
        showSuccessMessage('cart-message', `${item} added to cart`);
        showSection('cart');
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartUI();
        showSuccessMessage('cart-message', 'Item removed from cart');
    }

    function updateCartUI() {
        const cartItems = document.getElementById('cart-items');
        const cartCount = document.getElementById('cart-count');
        const cartTotal = document.getElementById('cart-total');
        const checkoutButton = document.getElementById('checkout-button');

        cartItems.innerHTML = '';
        cartCount.innerText = cart.length;

        if (cart.length === 0) {
            cartItems.innerHTML = '<p>Your cart is empty</p>';
            cartTotal.innerText = '$0.00';
            checkoutButton.disabled = true;
            return;
        }

        let total = 0;
        cart.forEach((item, index) => {
            total += item.price;
            const div = document.createElement('div');
            div.classList.add('cart-item');
            div.innerHTML = `
                <p>${item.item} - $${item.price.toFixed(2)}</p>
                <button onclick="removeFromCart(${index})" aria-label="Remove ${item.item} from cart">Remove</button>
            `;
            cartItems.appendChild(div);
        });

        cartTotal.innerText = `$${total.toFixed(2)}`;
        checkoutButton.disabled = false;
    }

    function checkout() {
        if (!cart.length) {
            showSuccessMessage('cart-message', 'Your cart is empty');
            return;
        }

        const popup = document.createElement('div');
        popup.classList.add('popup');
        popup.innerHTML = `
            <h3>Checkout</h3>
            <p>Total: $${cart.reduce((sum, item) => sum + item.price, 0).toFixed(2)}</p>
            <div id="payment-options">
                <button onclick="payWithCrypto()" aria-label="Pay with cryptocurrency">Pay with Crypto</button>
                <button onclick="showGiftCardUpload()" aria-label="Pay with gift card">Pay with Gift Card</button>
            </div>
            <div id="gift-card-upload" class="hidden">
                <input type="text" id="gift-card-code" placeholder="Gift Card Code..." aria-label="Enter gift card code">
                <input type="file" id="gift-card-image" accept="image/*" aria-label="Upload gift card image">
                <button onclick="submitGiftCard()" aria-label="Submit gift card payment">Submit Gift Card</button>
            </div>
            <div id="crypto-payment"></div>
            <p>Join our Telegram for updates: <a href="${telegramLink}" target="_blank" style="color: #ffcc00;">Join Now</a></p>
            <button onclick="this.parentElement.remove()" aria-label="Close checkout popup">Close</button>
        `;
        document.getElementById('popup-container').appendChild(popup);
    }

    async function payWithCrypto() {
        if (!currentUser.token) {
            showSuccessMessage('cart-message', 'Please login to proceed with payment');
            showSection('login');
            return;
        }

        const total = cart.reduce((sum, item) => sum + item.price, 0).toFixed(2);
        const items = cart.map(item => ({
            item: item.item,
            price: item.price,
            galleryIndex: item.galleryIndex
        }));

        try {
            const payment = await nowpaymentsApi.createPayment({
                price_amount: total,
                price_currency: 'USD',
                pay_currency: 'BTC', // Can be changed to other supported cryptocurrencies
                order_id: `order_${currentUser.id}_${Date.now()}`,
                order_description: `Purchase of ${items.map(i => i.item).join(', ')}`,
                ipn_callback_url: 'https://mealone-backend.onrender.com/api/payment/callback',
                success_url: window.location.href,
                cancel_url: window.location.href
            });

            const cryptoPaymentDiv = document.getElementById('crypto-payment');
            cryptoPaymentDiv.innerHTML = `<iframe src="${payment.payment_url}" class="nowpayments-iframe" title="Crypto Payment Checkout"></iframe>`;

            // Store payment details for verification
            await apiFetch('/api/vip/crypto', {
                method: 'POST',
                body: JSON.stringify({
                    paymentId: payment.payment_id,
                    items,
                    userEmail: currentUser.email
                })
            });
        } catch (error) {
            showSuccessMessage('cart-message', error.message || 'Failed to initiate crypto payment');
        }
    }

    async function submitGiftCard() {
        const code = document.getElementById('gift-card-code').value;
        const file = document.getElementById('gift-card-image').files[0];

        if (!code && !file) {
            showSuccessMessage('cart-message', 'Please enter a gift card code or upload an image');
            return;
        }

        const formData = new FormData();
        formData.append('code', code);
        if (file) {
            if (!file.type.startsWith('image/')) {
                showSuccessMessage('cart-message', 'Only images are allowed for gift card upload');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                showSuccessMessage('cart-message', 'Image too large (max 5MB)');
                return;
            }
            formData.append('giftCardImage', file);
        }
        formData.append('items', JSON.stringify(cart.map(item => ({
            item: item.item,
            price: item.price,
            galleryIndex: item.galleryIndex
        }))));
        formData.append('userEmail', currentUser.email);

        try {
            const data = await apiFetch('/api/vip/giftcard', {
                method: 'POST',
                body: formData,
                headers: {}
            });
            document.getElementById('popup-container').innerHTML = '';
            showSuccessMessage('cart-message', 'Gift card submitted for verification');
            showSection('dashboard');
        } catch (error) {
            showSuccessMessage('cart-message', error.errors?.join(', ') || error.error || 'Gift card submission failed');
        }
    }

    function showGiftCardUpload() {
        document.getElementById('gift-card-upload').classList.remove('hidden');
        document.getElementById('crypto-payment').innerHTML = '';
    }

    async function submitCheckout(item, index = null) {
        const cartItem = index !== null ? `Gallery Item ${index}` : item;
        if (cart.some(i => i.item === cartItem)) {
            showSuccessMessage('cart-message', `${cartItem} is in your cart. Please checkout from the cart.`);
            showSection('cart');
            return;
        }

        try {
            const data = await apiFetch('/api/vip/unlock', {
                method: 'POST',
                body: JSON.stringify({ item: index !== null ? `gallery-item-${index}` : item })
            });
            vipUnlocks.push({ item: index !== null ? `gallery-item-${index}` : item });
            localStorage.setItem('vipUnlocks', JSON.stringify(vipUnlocks));
            document.getElementById('popup-container').innerHTML = '';
            showSuccessMessage('dashboard-message', data.message || 'Purchase successful!');
            if (index !== null) {
                loadContentGallery();
            } else if (item === 'Live Stream') {
                document.getElementById('live-content').classList.remove('hidden');
            } else {
                document.getElementById(`vip-${item.toLowerCase().replace(/\s/g, '-')}`).classList.remove('hidden');
            }
        } catch (error) {
            showSuccessMessage('dashboard-message', error.errors?.join(', ') || error.error || 'Payment failed');
        }
    }

    function payForVip(item) {
        if (!currentUser.token) {
            showSuccessMessage('cart-message', 'Please login to proceed with payment');
            showSection('login');
            return;
        }
        if (cart.some(cartItem => cartItem.item === item)) {
            showSuccessMessage('cart-message', `${item} is already in your cart`);
            showSection('cart');
            return;
        }
        showPaymentPopup(item);
    }

    function payForGallery(index) {
        if (!currentUser.token) {
            showSuccessMessage('cart-message', 'Please login to proceed with payment');
            showSection('login');
            return;
        }
        if (cart.some(cartItem => cartItem.item === `Gallery Item ${index}`)) {
            showSuccessMessage('cart-message', `Gallery Item ${index} is already in your cart`);
            showSection('cart');
            return;
        }
        showPaymentPopup(`Gallery Item ${index}`, index);
    }

    async function payForLive() {
        if (!currentUser.token) {
            showSuccessMessage('cart-message', 'Please login to proceed with payment');
            showSection('login');
            return;
        }
        if (cart.some(cartItem => cartItem.item === 'Live Stream')) {
            showSuccessMessage('cart-message', 'Live Stream is already in your cart');
            showSection('cart');
            return;
        }
        showPaymentPopup('Live Stream');
    }

    function showPaymentPopup(item, index = null) {
        const price = prices[item] || 4.99;
        const popup = document.createElement('div');
        popup.classList.add('popup');
        popup.innerHTML = `
            <h3>Unlock ${item}</h3>
            <p>Price: $${price.toFixed(2)}</p>
            <div id="payment-options">
                <button onclick="payWithCryptoSingle('${item}', ${index})" aria-label="Pay with cryptocurrency for ${item}">Pay with Crypto</button>
                <button onclick="showGiftCardUploadSingle()" aria-label="Pay with gift card for ${item}">Pay with Gift Card</button>
            </div>
            <div id="gift-card-upload" class="hidden">
                <input type="text" id="gift-card-code" placeholder="Gift Card Code..." aria-label="Enter gift card code">
                <input type="file" id="gift-card-image" accept="image/*" aria-label="Upload gift card image">
                <button onclick="submitGiftCardSingle('${item}', ${index})" aria-label="Submit gift card payment for ${item}">Submit Gift Card</button>
            </div>
            <div id="crypto-payment"></div>
            <p>Join our Telegram for updates: <a href="${telegramLink}" target="_blank" style="color: #ffcc00;">Join Now</a></p>
            <button onclick="this.parentElement.remove()" aria-label="Close payment popup">Close</button>
        `;
        document.getElementById('popup-container').appendChild(popup);
    }

    async function payWithCryptoSingle(item, index = null) {
        if (!currentUser.token) {
            showSuccessMessage('dashboard-message', 'Please login to proceed with payment');
            showSection('login');
            return;
        }

        const price = prices[item] || 4.99;
        const cartItem = index !== null ? `Gallery Item ${index}` : item;

        try {
            const payment = await nowpaymentsApi.createPayment({
                price_amount: price,
                price_currency: 'USD',
                pay_currency: 'BTC', // Can be changed to other supported cryptocurrencies
                order_id: `order_${currentUser.id}_${Date.now()}`,
                order_description: `Purchase of ${cartItem}`,
                ipn_callback_url: 'https://mealone-backend.onrender.com/api/payment/callback',
                success_url: window.location.href,
                cancel_url: window.location.href
            });

            const cryptoPaymentDiv = document.getElementById('crypto-payment');
            cryptoPaymentDiv.innerHTML = `<iframe src="${payment.payment_url}" class="nowpayments-iframe" title="Crypto Payment Checkout for ${cartItem}"></iframe>`;

            // Store payment details for verification
            await apiFetch('/api/vip/crypto', {
                method: 'POST',
                body: JSON.stringify({
                    paymentId: payment.payment_id,
                    items: [{ item: cartItem, price, galleryIndex: index }],
                    userEmail: currentUser.email
                })
            });
        } catch (error) {
            showSuccessMessage('dashboard-message', error.message || 'Failed to initiate crypto payment');
        }
    }

    async function showGiftCardUploadSingle() {
        document.getElementById('gift-card-upload').classList.remove('hidden');
        document.getElementById('crypto-payment').innerHTML = '';
    }

    async function submitGiftCardSingle(item, index = null) {
        const code = document.getElementById('gift-card-code').value;
        const file = document.getElementById('gift-card-image').files[0];
        const cartItem = index !== null ? `Gallery Item ${index}` : item;

        if (!code && !file) {
            showSuccessMessage('dashboard-message', 'Please enter a gift card code or upload an image');
            return;
        }

        const formData = new FormData();
        formData.append('code', code);
        if (file) {
            if (!file.type.startsWith('image/')) {
                showSuccessMessage('dashboard-message', 'Only images are allowed for gift card upload');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                showSuccessMessage('dashboard-message', 'Image too large (max 5MB)');
                return;
            }
            formData.append('giftCardImage', file);
        }
        formData.append('items', JSON.stringify([{ item: cartItem, price: prices[item] || 4.99, galleryIndex: index }]));
        formData.append('userEmail', currentUser.email);

        try {
            const data = await apiFetch('/api/vip/giftcard', {
                method: 'POST',
                body: formData,
                headers: {}
            });
            document.getElementById('popup-container').innerHTML = '';
            showSuccessMessage('dashboard-message', 'Gift card submitted for verification');
            showSection('dashboard');
        } catch (error) {
            showSuccessMessage('dashboard-message', error.errors?.join(', ') || error.error || 'Gift card submission failed');
        }
    }

    async function loadVipUnlocks() {
        try {
            vipUnlocks = await apiFetch('/api/vip');
            vipUnlocks.forEach(vip => {
                const id = vip.item.toLowerCase().replace(/\s/g, '-');
                const element = document.getElementById(`vip-${id}`);
                if (element) element.classList.remove('hidden');
            });
        } catch (error) {
            showSuccessMessage('dashboard-message', 'Failed to load VIP unlocks');
        }
    }

    async function loadPaymentResponses() {
        const responses = document.getElementById('payment-responses');
        responses.innerHTML = '<h3>Payment Responses</h3>';
        try {
            paymentResponses = await apiFetch('/api/admin/payments');
            paymentResponses.forEach(resp => {
                const div = document.createElement('div');
                div.innerHTML = `<p><strong>${resp.user}</strong>: ${resp.message} (${new Date(resp.createdAt).toLocaleString()})</p>`;
                responses.appendChild(div);
            });
        } catch (error) {
            showSuccessMessage('dashboard-message', 'Failed to load payment responses');
        }
    }

    async function loadAdminPayments() {
        const payments = document.getElementById('admin-payments');
        payments.innerHTML = '';
        try {
            const data = await apiFetch('/api/admin/payments');
            data.forEach(payment => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <p><strong>User:</strong> ${payment.user}</p>
                    <p><strong>Item:</strong> ${payment.item}</p>
                    <p><strong>Code:</strong> ${payment.code || 'Crypto Payment'}</p>
                    <p><strong>Message:</strong> ${payment.message}</p>
                    <p><small>${new Date(payment.createdAt).toLocaleString()}</small></p>
                `;
                payments.appendChild(div);
            });
        } catch (error) {
            showSuccessMessage('admin-message', 'Failed to load payments');
        }
    }

    async function loadAdminGiftCards() {
        const giftCards = document.getElementById('admin-gift-cards');
        giftCards.innerHTML = '';
        try {
            const data = await apiFetch('/api/admin/giftcards');
            data.forEach(giftCard => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <p><strong>User:</strong> ${giftCard.userEmail}</p>
                    <p><strong>Items:</strong> ${giftCard.items.map(i => i.item).join(', ')}</p>
                    <p><strong>Code:</strong> ${giftCard.code || 'N/A'}</p>
                    ${giftCard.imageUrl ? `<p><strong>Image:</strong> <a href="https://mealone-backend.onrender.com${giftCard.imageUrl}" target="_blank">View</a></p>` : ''}
                    <p><small>${new Date(giftCard.createdAt).toLocaleString()}</small></p>
                `;
                giftCards.appendChild(div);
            });
        } catch (error) {
            showSuccessMessage('admin-message', 'Failed to load gift cards');
        }
    }

    async function sendResponse() {
        const userEmail = document.getElementById('response-user').value;
        const message = document.getElementById('response-message').value;

        if (!userEmail.match(/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/)) {
            showSuccessMessage('admin-message', 'Please enter a valid email');
            return;
        }
        if (!message) {
            showSuccessMessage('admin-message', 'Please enter a message');
            return;
        }

        try {
            await apiFetch('/api/admin/response', {
                method: 'POST',
                body: JSON.stringify({ userEmail, message })
            });
            showSuccessMessage('admin-message', 'Response sent');
            document.getElementById('response-user').value = '';
            document.getElementById('response-message').value = '';
        } catch (error) {
            showSuccessMessage('admin-message', error.errors?.join(', ') || error.error || 'Failed to send response');
        }
    }

    // Ad Popups
    function startAdPopups() {
        setInterval(() => {
            const popup = document.createElement('div');
            popup.classList.add('ad-popup');
            const link = affiliateLinks[Math.floor(Math.random() * affiliateLinks.length)];
            popup.innerHTML = `
                <p>${link.text}</p>
                <a href="${link.url}" target="_blank" style="color: #ffcc00;">Click Here</a>
                <button onclick="this.parentElement.remove()" aria-label="Close ad popup">Close</button>
            `;
            document.getElementById('popup-container').appendChild(popup);
            setTimeout(() => popup.remove(), 10000);
        }, 30000);
    }

    // Initialize
    initCart();
    if (currentUser.token) {
        loadProtectedContent();
    }
</script>